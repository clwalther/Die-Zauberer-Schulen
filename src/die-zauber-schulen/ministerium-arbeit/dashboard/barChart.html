<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      .chart-stack {
        transition: 5s;
        flex: 1;
      }
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 500px;
        background-color: #f0f0f0;
        margin-top: 50px;
      }
      .chart {
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        width: 100%;
        height: 80%;
      }
      .bar {
        width: 100px;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: 5s;
        background-color: #903333;
        height: 100%;
      }
      .rectangle {
        width: 100%;
        height: 50px;
        background-color: #a0a0a0;
        display: flex;
        justify-content: space-around;
        align-items: center;
      }
    </style>
    <title>Gestapeltes SÃ¤ulendiagramm auf Rechteck</title>
  </head>
  <body>
    <div class="container">
      <div class="chart">
      </div>
      <div class="rectangle">
        <div>Rechteck Text 1</div>
        <div>Rechteck Text 2</div>
        <div>Rechteck Text 3</div>
      </div>
    </div>
    <script>

      let colorArray = [
        ["#ff5733", "#d32f2f", "#b71c1c", "#860707"],
        ["#4B91FB", "#0064FA", "#2A518C", "#00317A"],
        ["#36B541", "#2E9937", "#00850B", "#006608"],
      ];

      const prestigeData = [
        [10, 124, 23, 12],
        [35, 54, 14, 12],
        [48, 80, 20, 34],
      ];

      let prestigeChartComponents = [];

      const orderCount = 3;
      const teamCount = 4;

      const chart = document.querySelector(".chart");

      for (order = 0; order < orderCount; order++) {
        const barComponent = document.createElement("div");
        barComponent.classList.add("bar");
        chart.appendChild(barComponent);
        const orderArray = [barComponent]
        for (team = 0; team < teamCount; team++) {
          const stackComponent = document.createElement("div");
          stackComponent.classList.add("chart-stack");
          barComponent.appendChild(stackComponent);
          stackComponent.style.backgroundColor = colorArray[order][team];
          orderArray.push(stackComponent);
        }
        prestigeChartComponents[order] = orderArray;
      }

      updateChart(prestigeData);

      function updateChart(newPrestigeData) {
        let maxSum = 0;

        let prestigeSumArray = [];

        newPrestigeData.forEach((teamArray) => {
          const sum = sumArray(teamArray);
          prestigeSumArray.push(sumArray(teamArray));
          if (sum > maxSum) {
            maxSum = sum;
          }
        });

        const maxBarHeight = 90;
        const factor = maxBarHeight / maxSum;

        for (order = 0; order < orderCount; order++) {
            prestigeChartComponents[order][0].style.height = `${prestigeSumArray[order] * factor}%`;
            const teamsPercentageArray = getPercentageArray(newPrestigeData[order]);
          for (team = 0; team < teamCount; team++) {
            prestigeChartComponents[order][team+1].style.flex = `${teamsPercentageArray[team]}`;
          }
        }
      }

      function sumArray(array) {
        return array.reduce((total, num) => total + num, 0);
      }

      function getPercentageArray(inputArray) {
        const totalSum = inputArray.reduce((total, num) => total + num, 0);
        if (totalSum === 0) {
          return inputArray.map(() => 0);
        }
        return inputArray.map((value) => (value / totalSum));
      }


      // Beispielaufruf der Funktion mit einem neuen teamData-Array
      const newTeamData = [
        [15, 100, 10, 40],
        [10, 50, 15, 140],
        [70, 40, 30, 43],
      ];

      setTimeout(() => {
        console.log("update chart");
        updateChart(newTeamData);
      }, 3000);

    </script>
  </body>
</html>
